function normalizeEntries(e){return Array.isArray(e)?e.map((e=>{if(e&&"object"==typeof e){const t=String(e.label||e.url||"").trim(),r=e.descriptor?String(e.descriptor).trim():"";return t?{label:t,descriptor:r}:null}const t=String(e||"").trim();if(!t)return null;const r=t.split(" - ");return{label:r.shift(),descriptor:r.join(" - ").trim()}})).filter(Boolean):[]}function dedupeEntries(e){const t=new Set,r=[];return e.forEach((({label:e,descriptor:n})=>{const o=String(e||"").trim();if(!o)return;const s=o.replace(/^https?:\/\//i,"").replace(/\/$/,"").toLowerCase();t.has(s)||(t.add(s),r.push({label:o,descriptor:n}))})),r}document.addEventListener("DOMContentLoaded",(()=>{const e={label:"mesaredux.mesagrey.ca",descriptor:"main site"};[{selector:'[data-mirror-type="official"]',jsonPath:"/assets/js/json/officialmirrors.json",emptyMessage:"No official mirrors available right now.",preprocess:t=>[e,...t]},{selector:'[data-mirror-type="unofficial"]',jsonPath:"/assets/js/json/unofficalmirrors.json",emptyMessage:"No unofficial mirrors submitted yet.",hideWhenEmpty:!0}].forEach((({selector:e,jsonPath:t,emptyMessage:r,hideWhenEmpty:n,preprocess:o})=>{const s=document.querySelector(e);s&&fetch(t).then((e=>{if(!e.ok)throw new Error(`Failed to fetch ${t}: ${e.status}`);return e.json()})).then((e=>{s.innerHTML="";const t=normalizeEntries(e),i=dedupeEntries(o?o(t):t);if(0!==i.length)i.forEach((({label:e,descriptor:t})=>{const r=document.createElement("li"),n=document.createElement("a"),o=/^https?:\/\//i.test(e)?e:`https://${e}`;n.href=o,n.target="_blank",n.rel="noopener noreferrer",n.textContent=t?`${e} - ${t}`:e,r.appendChild(n),s.appendChild(r)}));else if(n){const e=s.closest(".mirror-box")||s.closest(".contactbox");e&&(e.style.display="none")}else{const e=document.createElement("li");e.textContent=r,s.appendChild(e)}})).catch((e=>{console.error(e),s.innerHTML="";const t=document.createElement("li");t.textContent="Unable to load mirrors right now.",s.appendChild(t)}))}))}));
