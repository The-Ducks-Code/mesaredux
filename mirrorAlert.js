document.addEventListener("DOMContentLoaded",(()=>{const o=document.getElementById("mirror-alert");if(!o)return;const t="mesaredux.mesagrey.ca",r=`https://${t}/assets/js/json/buildinfo.json`,e=`https://${t}/assets/js/json/buildinfo.json`,n=[t],a=window.location.host.toLowerCase();if(a===t)return;const i=o=>{const r=new Set(o.map((o=>String(o||"").trim().toLowerCase())).filter(Boolean));return r.add(t),r};Promise.all([(async()=>{try{const o=await fetch("/assets/js/json/officialmirrors.json",{cache:"no-cache"});if(!o.ok)throw new Error(`Failed to load mirrors manifest: ${o.status}`);const t=await o.json();return i(Array.isArray(t)?t:n)}catch(o){return console.warn("Mirror manifest load failed, using fallback list.",o),i(n)}})(),(async()=>{try{const o=await fetch(r,{cache:"no-cache"});if(!o.ok)throw new Error(`Failed to load build info: ${o.status}`);return await o.json()}catch(o){return console.warn("Build info load failed.",o),null}})(),(async()=>{try{const o=await fetch(e,{cache:"no-cache"});if(!o.ok)throw new Error(`Failed to load latest build info: ${o.status}`);return await o.json()}catch(o){return console.warn("Latest build info load failed.",o),null}})()]).then((([r,e,n])=>((r,e,n)=>{const i=r.has(a),s=document.createElement("div");s.className="mirror-alert__banner",s.style.padding="0.75rem",s.style.marginBottom="0.7rem",s.style.borderRadius="0.5rem",s.style.fontSize="0.7rem",s.style.lineHeight="1.4",s.style.border="1px solid",s.style.backgroundColor=i?"#e6f4ea":"#fef3c7",s.style.borderColor=i?"#6abf69":"#f59e0b",s.style.color="#1f2933";const l=i?"Official mirror":"Unofficial mirror",c=i?`You are viewing an official MESλREDUX mirror on ${a||"localhost"}.`:`You are viewing an unofficial MESλREDUX mirror on ${a||"localhost"}.`,f=!n||e&&e.build_revision!==n.build_revision;s.innerHTML=`\n\n  <strong>${l}:</strong> ${c}<br>\n\n  <span>Try the main domain at <a href="https://${t}">${t}</a> if it is not blocked for you.</span>\n\n  ${e?n?f?"<br><strong>Notice:</strong> This mirror is running an outdated or modified build."+(i?" Please wait for changes to sync.":" Please consider using an official mirror for the latest updates."):`<br><strong>This ${i?"official":"unofficial"} mirror is up to date${i?".":" with latest git commit. HOWEVER, be careful, it may be host to malicious changes that aren't committed!"}</strong>`:`<br><strong>Unable to check for updates. This ${i?"official":"unofficial"} mirror is possibly out of date.</strong>`:""}\n\n`,o.replaceChildren(s)})(r,e,n)))}));
