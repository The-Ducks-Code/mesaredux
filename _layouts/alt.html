<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-CA" }}">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>{{ page.title }} - {{ site.title }}</title>
    <link rel="stylesheet" href="{{ "assets/css/alt.css" | relative_url }}">
    {% if page.title == "404" %}
    <script type="text/javascript" src="/assets/js/randoText404.js" defer></script>
    <script type="text/javascript" src="/assets/js/BGM.js" defer></script>
    {% else %}
    <script type="text/javascript" src="{{ "assets/js/resourceFallback.js" | relative_url }}"></script>
    {% endif %}
  {% if page.type == 'flash' %}
  <script>
    if (window.ResourceFallback && typeof window.ResourceFallback.loadScript === 'function') {
      window.ResourceFallback.loadScript({
        primary: 'https://unpkg.com/@ruffle-rs/ruffle',
        fallback: '{{ "/assets/libs/ruffle/ruffle.js" | relative_url }}',
        name: 'Ruffle'
      });
    }
  </script>
  {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }}"
        href="{{ "/feed.xml" | relative_url }}" />
  {% include meta.html %}
</head>
{% assign game_type = page.type | default: 'html' %}

<body data-type="{{ game_type }}">
    {% include gtag.html %}
    {% if page.title == "404" %}
    <audio id="BGM" preload="auto" data-local-src="{{ '/assets/music/whosthere.mp3' | relative_url }}" loop>
    </audio>
    {% endif %}
    <div class="container">
        <div class="box">
            {% if page.title == "404" or page.index == true %}
            {{ content }}
            {% else %}
            <div class="page-header">
            <h1 class="page-title">{{ page.title }}</h1>
            </div>
            <br>
            {% include breadcrumbs.html %}
            <br>
            <script type="text/javascript" src="/assets/js/aspectRatio.js"></script>
            <script>
                let aspectRatioInfo = getAspectRatioInfo('{{ page.aspectRatio }}')
            </script>
    {% if game_type == 'flash' %}
            <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
                <object width="100" height="100">
                <embed
                id="game-embed"
                src="{{ page.url | append: 'src/game.swf' | relative_url }}"
                flashvars=""
                base="" 
                quality="high"
                allowscriptaccess="always"
                allowfullscreen="true"
                wmode="window"
                type="application/x-shockwave-flash" 
                pluginspage="http://www.macromedia.com/go/getflashplayer">
                </object>
            ' allowfullscreen ></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
            <a href="{{ page.url | append: 'src/game.swf' | relative_url }}" download class="btn btn-secondary">Download</a>
      {% elsif game_type == 'html' %}
             <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
                <object width="100" height="100">
                <embed
                id="game-embed"
                src="{{ page.url | append: 'src/index.html' | relative_url }}"
                flashvars=""
                base="" 
                quality="high"
                allowscriptaccess="always"
                allowfullscreen="true"
                wmode="window"
                </object>
            ' allowfullscreen></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
    {% elsif game_type == 'retroarch' %}
             <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
             <!DOCTYPE html>
                <html lang="en">
                <head>
                    <style>
                        body, html {
                            margin: 0;
                            padding: 0;
                        }
                    </style>
                </head>
                <body>
                  <div style="width:100%;height:100%;max-width:100%">
                      <div id="ejsplayer"></div>
                  </div>
                    <script>
                      EJS_player = "#ejsplayer";
                      EJS_core = "{{ page.core }}";
                      EJS_pathtodata = "/assets/libs/emulatorjs/data";
                      EJS_startOnLoaded = true;
                      EJS_gameUrl = "{{ page.url | append: 'src/game.zip' | relative_url }}";
                    </script>
                    <script src="/assets/libs/emulatorjs/data/loader.js"></script>
                 </body>
              </html>
            ' allow="fullscreen" allowfullscreen></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
    {% elsif game_type == 'dos' %}
            <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<style>
  html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
  #dos-canvas { width: 100%; height: 100%; }
</style>
<script src="{{ "/assets/js/resourceFallback.js" | relative_url }}"></script>
</head>
<body>
<div id="dos-canvas"></div>
<script>
  (function () {
    var dosInstance = null;

    function bootDos() {
      var canvas = document.getElementById("dos-canvas");
      if (!canvas) {
        console.error("js-dos canvas unavailable");
        return;
      }
      if (typeof Dos !== "function") {
        console.error("js-dos library unavailable");
        return;
      }

      var options = {
        renderAspect: "Fit",
        autoStart: true,
        kiosk: true,
        autoSave: true,
        url: "{{ page.url | append: 'src/game.jsdos' | relative_url }}"
      };

      Dos(canvas, options)
        .then(function (instance) {
          dosInstance = instance;
          window.dosInstance = instance;
          window.__dosInstance = instance;
        })
        .catch(function (error) {
          console.error("Failed to initialise js-dos", error);
        });
    }

    window.requestDosFullscreen = function () {
      if (dosInstance && typeof dosInstance.setFullScreen === "function") {
        try {
          dosInstance.setFullScreen(true);
          return true;
        } catch (error) {
          console.error("js-dos fullscreen request failed", error);
        }
      }
      return false;
    };

    function loadDependencies() {
      if (!window.ResourceFallback || typeof window.ResourceFallback.loadScript !== "function") {
        setTimeout(loadDependencies, 50);
        return;
      }

      window.ResourceFallback.loadStyle({
        primary: "https://v8.js-dos.com/latest/js-dos.css",
        fallback: "{{ "/assets/libs/js-dos/js-dos.css" | relative_url }}",
        name: "js-dos styles"
      });

      window.ResourceFallback.loadScript({
        primary: "https://v8.js-dos.com/latest/js-dos.js",
        fallback: "{{ "/assets/libs/js-dos/js-dos.js" | relative_url }}",
        name: "js-dos"
      }).then(function () {
        bootDos();
      }).catch(function (error) {
        console.error("Failed to load js-dos script", error);
      });
    }

    if (document.readyState === "complete" || document.readyState === "interactive") {
      loadDependencies();
    } else {
      window.addEventListener("DOMContentLoaded", loadDependencies);
    }
  })();
</script>
</body>
</html>
' allow="fullscreen" allowfullscreen></iframe>
            </div>
      <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
            {% else %}
            <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" src="{{ page.url | append: 'src/index.html' | relative_url }}" allowfullscreen></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
            {% endif %}
            {% endif %}
            <link rel="stylesheet" href="{{ "assets/css/gameWrapper.css" | relative_url }}">
            <script type="text/javascript" src="/assets/js/gameWrapper.js"></script>
        </div>
    </div>
      <div class="footer" role="contentinfo">
      <div class="inner" style="text-align:center; padding:0.5em 1em;">
  <p>&copy; {% assign thisyear = site.time | date: "%Y" %}{% if thisyear == "2025" %}2025{% else %}2025 - {{ thisyear }}{% endif %} Bored Entertainment. All rights reserved.</p>
      </div>
    </div>
    {% if page.title == "404" %}
    <div id="background" class="background"></div>
    <div id="background2" class="background"></div>
    {% endif %}

</body>
</html>